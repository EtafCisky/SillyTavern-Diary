# 📚 日记本插件 - 安装与测试指南

## 🎉 插件开发完成！

日记本插件已经完全重构并准备就绪！这个版本是从酒馆助手脚本完全重新设计的原生SillyTavern插件。

## 📁 完整文件结构

```
日记本/
├── manifest.json              # 插件配置文件
├── index.js                   # 主入口文件
├── README.md                  # 插件说明文档
├── INSTALLATION.md           # 本安装指南
├── templates/                 # HTML模板文件
│   ├── settings.html         # 设置面板模板
│   └── buttons.html          # 功能按钮模板
├── styles/                   # 样式文件
│   ├── main.css             # 编译后的CSS文件（SillyTavern使用）
│   ├── main.scss            # 主SCSS文件
│   ├── _variables.scss      # 设计变量
│   ├── _buttons.scss        # 按钮样式
│   ├── _settings.scss       # 设置面板样式
│   ├── _diary-popup.scss    # 主弹窗样式
│   ├── _character-dialog.scss # 角色选择弹窗样式
│   └── _mobile.scss         # 移动端响应式样式
└── modules/                  # 功能模块
    ├── DiaryStorage.js      # 数据存储模块
    ├── PresetManager.js     # 预设管理模块
    ├── DiaryParser.js       # 消息解析模块
    ├── DiaryUI.js          # 界面管理模块
    └── CharacterDialog.js   # 角色选择弹窗模块
```

## 🚀 安装步骤

### 1. 复制插件文件
将整个 `日记本` 文件夹复制到SillyTavern的插件目录：
```
SillyTavern/scripts/extensions/third-party/日记本/
```

### 2. 重启SillyTavern
重新启动SillyTavern以加载新插件。

### 3. 启用插件
1. 打开SillyTavern
2. 进入扩展设置页面（Extensions）
3. 找到"📚 日记本设置"区域
4. 勾选"启用日记本功能"

### 4. 配置设置（可选）
- **预设设置**：点击日记本封面的设置按钮配置专用预设
- **移动端优化**：如果使用移动设备，建议启用此选项
- **自动删除消息**：建议保持启用，成功记录后自动清理对话

## 🧪 功能测试

### 测试1：基础界面
1. 点击"📖 日记本"按钮
2. 应该看到日记本封面界面
3. 检查统计数据显示是否正常

### 测试2：写日记流程
1. 点击"✍️ 写日记"按钮
2. 应该弹出角色选择对话框
3. 输入角色名或直接点击发送
4. 向AI描述今天的事情
5. AI应该返回包含日记格式的回复
6. 系统应该自动识别并保存日记

### 测试3：日记格式
确保AI回复包含以下格式：
```
［日记标题：今天很开心］
［日记时间：2024年3月15日］
［日记内容：今天发生了很多有趣的事情，我感到非常开心...］
```

### 测试4：手动记录
1. 如果自动识别失败
2. 点击"💾 记录"按钮
3. 系统应该尝试解析最新的AI消息

### 测试5：预设切换（如果已配置）
1. 配置一个日记专用预设
2. 点击"写日记"时应该自动切换预设
3. 完成后应该自动恢复之前的预设

### 测试6：移动端（如果适用）
1. 在移动设备上打开SillyTavern
2. 检查所有界面是否正常显示
3. 测试触摸交互是否流畅

## 🔍 调试信息

### 浏览器控制台
打开浏览器开发者工具，查看控制台输出：
- `📚 [日记本]` 开头的日志是插件主要信息
- `📚 [DiaryStorage]` 是数据存储相关
- `📝 [PresetManager]` 是预设管理相关
- `🎯 [DiaryParser]` 是消息解析相关
- `📖 [DiaryUI]` 是界面相关

### 常见问题
1. **模块导入失败**：检查文件路径是否正确
2. **样式加载失败**：确保CSS文件存在且可访问
3. **triggerSlash函数未定义**：确保SillyTavern版本兼容
4. **世界书创建失败**：检查SillyTavern的世界书功能是否正常

## ⚙️ 配置选项说明

### 扩展设置面板
在SillyTavern的Extensions页面找到"📚 日记本设置"：

- **启用日记本功能**：总开关，关闭后禁用所有功能
- **自动删除日记消息**：成功保存日记后自动删除对话中的相关消息
- **移动端优化**：启用移动端专用的界面优化和交互增强
- **世界书名称**：存储日记数据的世界书名称（默认："日记本"）

### 快捷操作
- **打开日记本**：快速打开日记浏览界面
- **导出日记数据**：（未来功能）导出所有日记数据
- **检查世界书状态**：验证数据存储是否正常

## 📈 性能优化

### 已实现的优化
- ✅ 模块化架构，按需加载
- ✅ CSS样式合并，减少HTTP请求
- ✅ 移动端专用优化
- ✅ 智能缓存机制
- ✅ 异步操作，避免界面阻塞

### 内存管理
- ✅ 弹窗关闭时自动清理DOM
- ✅ 事件监听器正确解绑
- ✅ 定时器自动清理
- ✅ 模块状态重置

## 🚨 故障排除

### 1. 插件无法加载
- 检查文件路径是否正确
- 确认manifest.json格式正确
- 查看浏览器控制台错误信息

### 2. 样式显示异常
- 确认main.css文件存在
- 检查CSS语法是否正确
- 尝试刷新页面清除缓存

### 3. 功能按钮不显示
- 检查templates/目录下的HTML文件
- 确认jQuery选择器正确
- 验证DOM结构是否符合预期

### 4. 日记无法保存
- 检查世界书功能是否正常
- 确认triggerSlash函数可用
- 验证日记格式是否正确

### 5. 预设切换失败
- 确认所选预设确实存在
- 检查SillyTavern预设功能
- 尝试手动切换预设测试

## 📞 支持联系

如果遇到问题：
1. 查看浏览器控制台的详细错误信息
2. 检查SillyTavern版本兼容性
3. 参考README.md中的故障排除部分
4. 在相关社区寻求帮助

---

**祝您使用愉快！** 🎉✨

这个插件将为您的SillyTavern体验带来全新的日记管理功能。
